<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>购物车</title>
	<link rel="stylesheet" href="lib/bootstrap-icons/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="lib/bootstrap-table/dist/bootstrap-table.min.css">
	<link rel="stylesheet"
		href="lib/bootstrap-table/dist/extensions/fixed-columns/bootstrap-table-fixed-columns.min.css">
	<link rel="stylesheet" href="lib/@eonasdan/tempus-dominus/dist/css/tempus-dominus.min.css" />
	<link rel="stylesheet" href="lib/bootstrap-select/dist/css/bootstrap-select.min.css">
	<link rel="stylesheet" href="dist/css/bootstrap-admin.min.css">

</head>

<body>
	<div class="container">
		<a href="index.html" class="btn btn-primary" style="float: right;">返回首页</a> <!-- 添加返回首页的按钮 -->
		<h1>购物车</h1>
		<div class="card-body">
			<!--  表格上方左侧的工具条区域    -->
			<div id="toolbar" class="d-flex flex-wrap gap-2 mb-2">
				<button class="btn btn-light add-btn"><i class="bi bi-plus"></i> 新增
				</button>
				<button class="btn btn-light batch-btn" disabled><i class="bi bi-trash"></i> 批量删除</button>
				<button class="btn btn-light"><i class="bi bi-box-arrow-down"></i> 导入</button>
				<button class="btn btn-light"><i class="bi bi-box-arrow-up"></i> 导出</button>
			</div>
			<!--  数据表格    -->
			<table id="table" class="table"></table>
		</div>
		<hr>
		<div class="row g-3">
			<div class="col-md-6">
				<h2>结算信息</h2>
				<form>
					<div class="mb-3">
						<label for="name" class="form-label">姓名</label>
						<input type="text" class="form-control" id="name">
					</div>
					<div class="form-group">
						<label for="searchAddress" class="control-label">地址：</label>
						<select class="form-control" id="searchAddress" name="address" tabindex="1"
							data-toggle="popover" title="请选择地址">
							<option value="" selected>全部</option>
						</select>
					</div>
					<button type="submit" class="btn btn-primary">确认结算</button>
				</form>
			</div>
			<div class="col-md-6">
				<h2>订单总额</h2>
				<table class="table">
					<tbody>
						<tr>
							<td>商品总价</td>
							<td id="subtotal">￥0.00</td>
						</tr>
						<tr>
							<td>运费</td>
							<td>￥0.00</td>
						</tr>
						<tr>
							<td>优惠券</td>
							<td>-￥0.00</td>
						</tr>
						<tr>
							<th>总计</th>
							<th id="total">￥0.00</th>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>

	<script src="lib/jquery/dist/jquery.min.js"></script>
	<script src="lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	<script src="lib/@popperjs/core/dist/umd/popper.min.js"></script>
	<script src="lib/@eonasdan/tempus-dominus/dist/js/tempus-dominus.min.js"></script>
	<script src="lib/bootstrap-table/dist/bootstrap-table.min.js"></script>
	<script src="lib/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js"></script>
	<script src="lib/bootstrap-table/dist/extensions/fixed-columns/bootstrap-table-fixed-columns.min.js"></script>
	<!-- <script src="lib/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
	<script src="lib/bootstrap-select/dist/js/i18n/defaults-zh_CN.min.js"></script> -->

	<script src="dist/js/bootstrap-admin.min.js"></script>
	<script src="dist/js/app.js"></script>
	<script src="pagejs/rockjs-1.0.js"></script>
	<script src="pagejs/common.js"></script>
	<script>
		var ssoUser = null;  //当前用户
		_root.loginCustomer({}, function (rtn, status) {
			if (rtn.hasError) {
				alert(rock.errorText(rtn, "获得当前用户失败！"));
			} else {
				ssoUser = rtn.result;
			}
			if (rock.isNull(ssoUser)) {
				console.log("非法访问——————小阳在看着你呢");
			} else {
				console.log(ssoUser);
				console.log(ssoUser.id);
			}
		})
		/**
		 * 获得表格组件
		 */
		function getBootstrapTable() {
			return $("#tableData");
		}

		$(function () {
			// 更新订单总额
			function updateTotal() {
				var subtotal = 0;
				$("table tbody tr").each(function () {
					var price = parseFloat($(this).find("td:nth-child(3)").text().substring(1));
					var quantity = parseInt($(this).find("input[type='number']").val());
					if ($(this).find("input[type='checkbox']").is(":checked")) {
						subtotal += price * quantity;
					}
				});
				$("#subtotal").text("￥" + subtotal.toFixed(2));
				$("#total").text("￥" + subtotal.toFixed(2));
			}

			// 监听复选框和数量输入框的变化
			$("input[type='checkbox'], input[type='number']").on("change", updateTotal);




			$('#table').bootstrapTable({
				//配置语言
				locale: 'zh-CN',
				//设置高度就可以固定表头
				// height: 500,
				//请求地址
				url: 'http://127.0.0.1:8080/spring-boot/shopCart/queryPage',
				   //需要自己写一个url，function或者json给他
				// xhrFields: {
				// 	withCredentials: true
				// },
				queryParamsType: "page",
				responseHandler: function (res) {
					var data = {};
					if (res.hasError) {
						alert(rock.errorText(res, "无法获得数据列表!"));
					}
					else {
						var ps = res.result;
						data.total = ps.totalCount;
						data.rows = ps.content;
					}
					// alert(res.data);
					return data;
				},
				//是否开启分页
				pagination: true,
				//是客户端分页还是服务端分页  'client','server',由于演示没有后端提供服务，所以采用前端分页演示
				sidePagination: 'server',
				// 初始化加载第一页，默认第一页
				pageNumber: 1,
				//默认显示几条
				pageSize: 5,
				//可供选择的每页的行数 - (亲测大于1000存在渲染问题)
				pageList: [5, 10, 25, 50, 100],
				//在上百页的情况下体验较好 - 能够显示首尾页
				paginationLoop: true,
				// 展示首尾页的最小页数
				paginationPagesBySide: 2,

				// 唯一ID字段
				uniqueId: 'id',
				// 每行的唯一标识字段
				idField: 'id',
				// 是否启用点击选中行
				clickToSelect: true,

				// 是否显示详细视图和列表视图的切换按钮
				showToggle: true,
				// 请求得到的数据类型
				dataType: 'json',
				// 请求方法
				method: 'get',
				// 工具按钮容器
				toolbar: '#toolbar',
				// 是否显示所有的列
				showColumns: true,
				// 是否显示刷新按钮
				showRefresh: true,
				// 显示图标
				showButtonIcons: true,
				// 总数字段
				totalField: 'total',
				// 当字段为 undefined 显示
				undefinedText: '-',
				// 排序方式
				sortOrder: "asc",
				//默认排序
				sortName: "id",
				// 按钮的类
				buttonsClass: 'light',
				// 类名前缀
				buttonsPrefix: 'btn',
				// 图标前缀
				iconsPrefix: 'bi',
				// 图标大小 undefined sm lg
				iconSize: undefined,
				// 图标的设置  这里只做了一个演示，可设置项目参考 https://examples.bootstrap-table.com/#options/table-icons.html
				icons: {
					fullscreen: 'bi-arrows-fullscreen',
				},
				//头部的那个复选框选中事件
				onCheckAll: function (row) {
					batchBtnStatusHandle()
				},
				//单行选中事件
				onCheck: function (row) {
					batchBtnStatusHandle()
				},
				//单行取消选中事件
				onUncheck: function (row) {
					batchBtnStatusHandle()
				},
				//头部的那个复选框取消选中事件
				onUncheckAll: function (row) {
					batchBtnStatusHandle()
				},
				//加载模板,不改的话，默认的会超出不好看
				loadingTemplate: function () {
					return '<div class="spinner-grow" role="status"><span class="visually-hidden">Loading...</span></div>';
				},
				onPostBody: function () {
					//重新启用弹出层,否则formatter格式化函数返回的html字符串上的tooltip提示不生效
					$('[data-bs-toggle="tooltip"]').each(function (i, el) {
						new bootstrap.Tooltip(el)
					})
				},
				//params是一个对象
				queryParams: function (options) {
					// return param;
					
					return { 
						pageSize: options.pageSize,
						pageNum: options.pageNumber,
						sort: options.sortName + " " + options.sortOrder,
					}
				},
				//列
				columns: [
					{
						checkbox: true,
						//是否显示该列
						visible: true,
					},
					{
						title: 'id',
						field: 'id',
						// 使用[align]，[halign]和[valign]选项来设置列和它们的标题的对齐方式。h表示横向，v标识垂直
						align: 'center',
						// 是否作为排序列
						sortable: true,
						// 当列名称与实际名称不一致时可用
						//sortName: 'id',
						switchable: false,
						// 列的宽度
						width: 8,
						// 宽度单位
						widthUnit: 'rem'
					},
					//  {
					// 	title: '顾客账号',
					// 	field: 'customerCode',
					// 	align: 'center',
					// 	sortable: true,
					// },
					{
						title: '商品编号',
						field: 'productId',
						align: 'center',
						sortable: true,
					},
					{
						title: '商品数量',
						field: 'quantity',
						align: 'center',
						sortable: true,

					}
				]

			});


		});

	</script>

</body>

</html>