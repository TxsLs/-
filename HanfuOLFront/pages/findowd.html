<!doctype html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="icon" href="../dist/img/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="../dist/img/favicon-16x16.png" sizes="16x16" type="image/png">
    <meta name="keywords" content="响应式后台模板,开源免费后台模板,Bootstrap5后台管理系统模板">
    <meta name="description" content="bootstrap-admin基于bootstrap5的免费开源的响应式后台管理模板">
    <meta name="author" content="ajiho">
    <link rel="stylesheet" href="../lib/bootstrap-icons/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../lib/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../dist/css/bootstrap-admin.min.css">
    <title>注册页</title>
</head>

<body class="bg-body-tertiary">

    <div class="d-flex align-items-center justify-content-center">
        <div style="width: 400px; max-width: 100%; margin-top: 12vh;" class="p-2">
            <h2 class="text-center">申请找回密码</h2>
            <p class="text-secondary text-center">填写个人信息</p>

            <form id="form" class="form">
                <div class="mb-3">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="bi bi-person-vcard"></i></span>
                        <input type="text" class="form-control" id="code" name="code" maxlength="20" tabindex="2"
                            autocomplete="on" placeholder="请输入账号" required data-bv-container="#err_username"
                            pattern="^[A-Za-z0-9]{0,20}$">
                    </div>

                </div>

                <div class="mb-3">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="bi bi-person"></i></span>
                        <input type="text" class="form-control" id="name" name="name" maxlength="20" tabindex="2"
                            aria-label="name" autocomplete placeholder="请输入姓名" required
                            data-bv-container="#err_username" pattern="^[\u4e00-\u9fa5A-Za-z0-9\uFF01-\uFFEF]{0,20}$">
                    </div>

                </div>

                <div class="mb-3">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="bi bi-telephone"></i></span>
                        <input type="tel" class="form-control" id="phone" name="phone" tabindex="8" autocomplete
                            placeholder="请输入电话号码" required data-bv-container="#err_phone" maxlength="11">
                    </div>
                    <!-- <div id="err_phone" style="text-align: left;"></div> -->
                </div>

                <div class="mb-3">
                    <div class="input-group bsa-show_hide_password">
                        <span class="input-group-text bg-white"><i class="bi bi-person-lock"></i></span>
                        <input type="password" class="form-control" id="password" name="newPassword" maxlength="20"
                            autocomplete="off" aria-label="password" tabindex="4" placeholder="请输入密码" required
                            data-bv-container="#err_password" pattern="^[\S]{0,20}$">
                        <span class="input-group-text bg-white bsa-cursor-pointer"><i
                                class="bi bi-eye-slash"></i></span>
                    </div>

                </div>

                <!-- 添加确认密码输入框 -->
                <div class="mb-3">
                    <div class="input-group bsa-show_hide_password">
                        <span class="input-group-text bg-white"><i class="bi bi-shield-check"></i></span>
                        <input type="password" class="form-control" id="confirmpassword" name="confirmpassword"
                            maxlength="20" autocomplete="off" tabindex="4" placeholder="请再次输入密码" required
                            data-bv-container="#err_confirmpassword">
                        <span class="input-group-text bg-white bsa-cursor-pointer"><i
                                class="bi bi-eye-slash"></i></span>
                    </div>
                    <!-- <div id="err_confirmpassword" style="text-align: left;"></div> -->
                </div>

                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary" tabindex="12" type="submit"><i class="bi bi-binoculars"></i>
                        找回密码</button>
                </div>


            </form>
            <div class="d-grid gap-2">
                <button class="btn btn-outline-primary" tabindex="12" onclick="redirectToLogin()"><i
                        class="bi bi-back"></i>
                    返回</button>
            </div>
            <!-- <div class="mt-3 text-center">
        <p>已有账号？<a href="login.html" class="link-success text-decoration-none">立即登录</a></p>
      </div> -->

        </div>
    </div>




    <script src="../lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../lib/jquery/dist/jquery.min.js"></script>
    <script src="../lib/formvalidation/js/formValidation.js"></script>
    <script src="../lib/formvalidation/js/framework/bootstrap.js"></script>
    <script src="../lib/formvalidation/js/language/zh_CN.js"></script>
    <script src="../dist/js/bootstrap-admin.min.js"></script>
    <script src="../dist/js/app.js"></script>


    <!-- <script type="text/javascript" src="../dist/js/bootstrapValidator-rock.js"></script> -->
    <script type="text/javascript" src="../pagejs/rockjs-1.0.js"></script>
    <script type="text/javascript" src="../pagejs/common.js"></script>


    <script>


        function redirectToLogin() {
            window.location.href = "../login.html";
        }
        $(function () {
            //前端表单验证

            $('#form').formValidation({

                fields: {
                    code: {
                        validators: {
                            notEmpty: {
                                message: '账号不能为空'
                            },
                            stringLength: {
                                min: 1,
                                max: 20,
                                message: '用户名长度必须在1到20个字符之间'
                            }
                        }
                    },
                    name: {
                        validators: {
                            notEmpty: {
                                message: '姓名不能为空'
                            },
                            stringLength: {
                                min: 1,
                                max: 20,
                                message: '用户名长度必须在1到20个字符之间'
                            }
                        }
                    },
                    newPassword: {
                        validators: {
                            notEmpty: {
                                message: '密码不能为空'
                            },
                            stringLength: {
                                min: 6,
                                max: 20,
                                message: '密码长度必须在6到20个字符之间'
                            }
                        }
                    },

                    confirmpassword: {
                        validators: {
                            notEmpty: {
                                message: '密码不能为空'
                            },

                            identical: {//相同
                                field: 'newPassword',
                                message: '两次输入的密码不一致'
                            }
                        }
                    },


                    phone: {
                        validators: {
                            notEmpty: {
                                message: '电话号码不能为空'
                            },
                            regexp: {
                                regexp: /^\d{11}/,
                                message: '请输入有效的11位电话号码!'
                            }
                        }
                    }

                }
            }).on('success.form.fv', function (e) {

                //阻止表单提交
                e.preventDefault();

                // 得到表单对象
                let $form = $(e.target);
                // 获取表单数据
                let formData = $form.serializeArray();
                // 将序列化数据转换为字符串
                let data = $.param(formData);

                //发起ajax请求
                $.ajax({
                    method: 'Post',
                    url: 'http://127.0.0.1:8080/spring-boot/customer/findSelfPassword',
                    //表单数据
                    data: data,
                }).then(response => {
                    if (response.result) {
                        $.toasts({
                            type: 'success',
                            content: '重置密码成功！',
                            onHidden: function () {
                                location.href = '../login.html';
                            }
                        });
                    } else if (response.hasError) {
                        var errorMessage = rock.errorText(response, "找回密码失败!");
                        $.toasts({
                            type: 'danger',
                            content: errorMessage,
                            delay: 3050, // 将显示时间设置
                            onShown: function () {
                                if (response.errorCode === "1069") {
                                    $("#code").focus();
                                }
                            }
                        });


                    }
                    // $.toasts({
                    //   type: 'danger',
                    //   content: '注册失败！',
                    //   // onHidden: function () {
                    //   //   location.href = 'register.html';
                    //   // }
                    // });
                    // if (response.errorCode == "1067") {
                    //   alert(rock.errorText(response, "注册错误!"));
                    //   $("#code").focus();

                    // }

                });
            });
        });
    </script>
</body>

</html>